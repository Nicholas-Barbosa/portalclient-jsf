<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<f:facet name="first">
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<link rel="icon"
			href="#{request.contextPath}/resources/rain-layout/images/favicon.ico"
			type="image/x-icon"></link>
	</f:facet>
	<title>Pesquisar produto</title>
</h:head>

<h:body styleClass="#{userStylePreferences.inputStyleClass}">
	<f:metadata>
		<f:viewParam name="customerStore"
			value="#{searchProductController.customerStore}" />
		<f:viewParam name="customerCode"
			value="#{searchProductController.customerCode}" />
		<f:viewParam name="customerType"
			value="#{searchProductController.customerType}" />
		<f:viewParam name="customerPropState"
			value="#{searchProductController.state}" />
		<f:viewParam name="customerPropSelType"
			value="#{searchProductController.customerSellerType}" />
	</f:metadata>


	<p:growl globalOnly="true" id="growl" showDetail="true" />

	<div class="card">

		<div class="ui-fluid">
			<h:form id="formProductDetails">
				<div class="p-field">
					<p:outputLabel for="code">#{resourceBundleServiceImpl.getMessage('codigo_comercial')}</p:outputLabel>
					<div class="ui-inputgroup">
						<p:inputText id="code"
							value="#{searchProductController.productCodeToSearch}" />

						<p:commandButton icon="pi pi-search"
							styleClass="ui-button-warning" process="@this,code"
							action="#{searchProductController.search}"
							onstart="PF('dlgLoading').show()"
							oncomplete="PF('dlgLoading').hide()" />
					</div>
				</div>
				<p:remoteCommand name="loadImage"
					action="#{newBudgetOrderController.loadImageFromPreviewProduct}"
					async="true" update="@form"
					onstart="$('#spinnerLoadingImage').show();$('#divProductImg').hide();"
					oncomplete="$('#spinnerLoadingImage').hide();
				$('#divProductImg').show();" />
				<i class="pi pi-spin pi-spinner"
					style="font-size: 5rem; display: none" id="spinnerLoadingImage"></i>
				<div id="divProductImg">
					<p:graphicImage
						value="#{searchProductController.product.imageStreams}"
						styleClass="product-image" stream="false" id="productImg"
						alt="Image not uploaded for #{searchProductController.product.commercialCode}"
						rendered="#{searchProductController.product.image.currentState eq 'FOUND' || 'NOT_FOUND'}" />
					<p:button
						value="#{resourceBundleServiceImpl.getMessage('timeout_busca_imagem_gcp')}"
						rendered="#{searchProductController.product.image.currentState eq 'TIMEOUT_EXCPTION'}"
						onclick="loadImage()" id="btnReloadImage" />
				</div>
				<br />

				<div class="p-field">
					<p:outputLabel for="name">#{resourceBundleServiceImpl.getMessage('descricao')}</p:outputLabel>
					<p:inputTextarea id="name"
						value="#{searchProductController.product.description}"
						required="true" readonly="true" />
				</div>
				<div class="p-field">
					<p:outputLabel for="line">#{resourceBundleServiceImpl.getMessage('linha')}</p:outputLabel>
					<p:inputText id="line"
						value="#{searchProductController.product.line}" readonly="true" />
				</div>
				<ui:fragment
					rendered="#{!searchProductController.product.applicability.blank}">
					<div class="p-field">
						<p:outputLabel for="aplicability">#{resourceBundleServiceImpl.getMessage('aplicacao')}</p:outputLabel>
						<p:inputText id="aplicability"
							value="#{newBudgetOrderController.previewItem.product.applicability}"
							readonly="true" />

					</div>
				</ui:fragment>

				<div class="p-formgrid p-grid">
					<div class="p-field p-col">
						<p:outputLabel for="vLiquid">#{resourceBundleServiceImpl.getMessage('valor_liquido')}</p:outputLabel>
						<p:inputNumber id="vLiquid"
							value="#{searchProductController.product.value.unitValue}"
							symbol="R$ " symbolPosition="p" decimalSeparator=","
							thousandSeparator="." readonly="true" />
					</div>
					<div class="p-field p-col">
						<p:outputLabel for="vGross">#{resourceBundleServiceImpl.getMessage('valor_bruto')}</p:outputLabel>
						<p:inputNumber id="vGross"
							value="#{searchProductController.product.value.unitGrossValue}"
							symbol="R$ " symbolPosition="p" decimalSeparator=","
							thousandSeparator="." readonly="true" />
					</div>
					<div class="p-field p-col">
						<p:outputLabel for="vSt">#{resourceBundleServiceImpl.getMessage('valor_st')}</p:outputLabel>
						<p:inputNumber id="vSt"
							value="#{searchProductController.product.value.unitStValue}"
							symbol="R$ " symbolPosition="p" decimalSeparator=","
							thousandSeparator="." readonly="true" />
					</div>
				</div>
				<p:remoteCommand name="confirmProduct"
					action="#{newBudgetOrderController.addPreviewItemToBudget}"
					onstart="$('body').css('cursor', 'progress');PF('blockPanelAll').show()"
					oncomplete="PF('serachProductDialog').hide(); $('body').css('cursor', 'default');PF('blockPanelAll').hide();$('#footer').hide();turnDtScrollBodyResponsive('dtItems','45vh');"
					process="@this manage-product-content"
					update="@form,@obs(eventAddItem)" />

				<div id="footer" style="display: none">
					<p:commandButton type="button"
						value="#{resourceBundleServiceImpl.getMessage('confirmar')}"
						icon="pi pi-check"
						styleClass="ui-button-raised ui-button-success p-mr-2 p-mb-2"
						action="#{searchProductController.confirm}" id="btnConfirm" />
					<p:commandButton
						value="#{resourceBundleServiceImpl.getMessage('cancelar')}"
						icon="pi pi-times" action="#{searchProductController.cancel}"
						styleClass="ui-button-raised ui-button-danger p-mr-2 p-mb-2" />
				</div>
			</h:form>
		</div>

	</div>
	
	<p:dialog header="Buscando produto..." modal="true" closable="false"
		widgetVar="dlgLoading">
		<i class="pi pi-spin pi-spinner" style="font-size: 4rem"></i>

	</p:dialog>
	<h:outputStylesheet name="css/#{userStylePreferences.layout}.css"
		library="rain-layout" />
</h:body>
</html>
