<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="../WEB-INF/template.xhtml"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<ui:define name="head">
		<h:outputStylesheet name="css/flags/flags.css" library="demo" />
	</ui:define>

	<ui:define name="title">#{resourceBundleServiceImpl.getMessage('orcamento_message')}</ui:define>

	<ui:define name="viewname">
		<li>#{resourceBundleServiceImpl.getMessage('compras_message')}</li>
		<li><i class="pi pi-chevron-right"></i></li>
		<li>#{resourceBundleServiceImpl.getMessage('orcamento_message')}</li>
		<li><i class="pi pi-chevron-right"></i></li>
		<li><p:link
				outcome="/faces/editBudget?budgetID=#{editBudgetController.budgetID}">#{resourceBundleServiceImpl.getMessage('editar')} - #{editBudgetController.budgetID}</p:link>
		</li>
	</ui:define>

	<ui:define name="content">
		<f:view locale="pt_BR">
			<f:metadata>
				<f:viewParam name="budgetID"
					value="#{editBudgetController.budgetID}" required="true"
					requiredMessage="ID do orçamento é obrigatório para esta visualização."
					id="idParam" />
			</f:metadata>

			<p:growl id="growl" showDetail="true" globalOnly="true"
				widgetVar="growl" />
			<p:growl id="growlParam" showDetail="true" for="idParam" />

			<h:form>
				<p:remoteCommand autoRun="true"
					action="#{editBudgetController.getById}" process="@this"
					oncomplete="$('#divLoading').hide();$('#content').show()"
					update="panelCustomer,panelItems,panelTotals" />
			</h:form>

			<div class="card" id="divLoading">
				Loading...
				<div class="custom-skeleton p-p-4">
					<div class="p-d-flex p-mb-3">
						<p:skeleton shape="circle" size="4rem" class="p-mr-2" />
						<div>
							<p:skeleton width="10rem" class="p-mb-2" />
							<p:skeleton width="5rem" class="p-mb-2" />
							<p:skeleton height=".5rem" />
						</div>
					</div>
					<p:skeleton width="100%" height="150px" />
					<div class="p-d-flex p-jc-between p-mt-3">
						<p:skeleton width="4rem" height="2rem" />
						<p:skeleton width="4rem" height="2rem" />
					</div>
				</div>
			</div>
			<div id="content" style="display: none">
				<div class="card">
					<h5>Cliente</h5>
					<p:outputPanel deferred="true" id="panelCustomer">
						<div class="ui-fluid p-formgrid p-grid">
							<div class="p-field p-col">
								<label for="firstname">Código</label>
								<p:inputText id="firstname" type="text" readonly="true"
									value="#{editBudgetController.budget.customerOnOrder.code}" />
							</div>
							<div class="p-field p-col">
								<label for="lastname">Loja</label>
								<p:inputText id="lastname" type="text" readonly="true"
									value="#{editBudgetController.budget.customerOnOrder.store}" />
							</div>
							<p:commandButton value="Carregar dados adicionais" />
						</div>
					</p:outputPanel>
				</div>

				<div class="card">
					<p:outputPanel deferred="true" deferredMode="visible"
						id="panelItems">
						<h:form prependId="false">
							<p:dataTable var="item"
								value="#{editBudgetController.budget.items}" id="dtItems"
								editable="true">
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('codigo')}">
									<h:outputText value="#{item.product.commercialCode}" />
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('quantidade')}">
									<p:cellEditor>
										<f:facet name="output">
											<h:outputText value="#{item.values.quantity}" />
										</f:facet>
										<f:facet name="input">
											<p:spinner />
										</f:facet>
									</p:cellEditor>

								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('valor_unitario')}">
									<h:outputText value="#{item.product.value.unitValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('valor')}">
									<h:outputText
										value="#{item.values.getTotalValueWithoutDiscount()}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('total_st')}">
									<h:outputText
										value="#{item.values.getTotalStValueWithoutDiscount()}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('valor_bruto')}">
									<h:outputText
										value="#{item.values.getTotalGrossWithoutDiscount()}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('desc_linha')}">
									<h:outputText value="#{item.values.lineDiscount}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('total_cm_desc')}">
									<h:outputText value="#{item.values.totalValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column headerText="ST">
									<h:outputText value="#{item.values.totalStValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('bruto_cm_desc')}">
									<h:outputText value="#{item.values.totalGrossValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column style="width:6rem">
									<p:rowEditor editTitle="Edit Row" cancelTitle="Cancel Edit"
										saveTitle="Save Row" />
								</p:column>
							</p:dataTable>
						</h:form>
					</p:outputPanel>
				</div>

				<div class="card">
					<p:outputPanel id="panelTotals" deferred="true"
						deferredMode="visible">
						<h:form id="totals">
							<div class="ui-fluid p-formgrid p-grid">
								<div class="p-field p-col-12 p-md-3">
									<p:outputLabel for="liquidV"
										value="#{resourceBundleServiceImpl.getMessage('total_sem_st')}" />
									<p:inputNumber id="liquidV"
										value="#{editBudgetController.budget.liquidValue}"
										symbol="R$ " symbolPosition="p" readonly="true"
										decimalSeparator="," thousandSeparator="." />
								</div>
								<div class="p-field p-col-12 p-md-3">
									<p:outputLabel for="stT"
										value="#{resourceBundleServiceImpl.getMessage('valor_st')}" />
									<p:inputNumber id="stT"
										value="#{editBudgetController.budget.stValue}" symbol="R$ "
										symbolPosition="p" readonly="true" decimalSeparator=","
										thousandSeparator="." />
								</div>
								<div class="p-field p-col-12 p-md-3">
									<p:outputLabel for="grossV"
										value="#{resourceBundleServiceImpl.getMessage('total_com_st')}" />
									<p:inputNumber id="grossV"
										value="#{editBudgetController.budget.grossValue}" symbol="R$ "
										symbolPosition="p" readonly="true" decimalSeparator=","
										thousandSeparator="." />
								</div>
							</div>
							<p:autoUpdate on="eventAddItem" />
						</h:form>
					</p:outputPanel>
				</div>

			</div>
		</f:view>
	</ui:define>

</ui:composition>