<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="../WEB-INF/template.xhtml"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<ui:define name="head">
		<h:outputStylesheet name="css/flags/flags.css" library="demo" />
		<h:outputScript name="CssModifier.js" library="javascript" />
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"></link>
		<h:outputStylesheet name="item-row-expansion.css" library="css" />

	</ui:define>

	<ui:define name="title">
		FarAway | #{resourceBundleServiceImpl.getMessage('orcamento_message')}
	</ui:define>

	<ui:define name="viewname">
		<li>#{resourceBundleServiceImpl.getMessage('compras_message')}</li>
		<li><i class="pi pi-chevron-right"></i></li>
		<li>#{resourceBundleServiceImpl.getMessage('orcamento_message')}
		</li>
		<li><i class="pi pi-chevron-right"></i></li>
		<li><p:link outcome="/faces/newBudget">
					#{resourceBundleServiceImpl.getMessage('novo_orcamento')}
			</p:link></li>
	</ui:define>

	<ui:define name="content">
		<f:view locale="pt_BR">

			<p:growl id="growl" showDetail="true" globalOnly="true"
				widgetVar="growl" />
			<div class="card">

				<h:form id="budgetToolsForm">
					<p:toolbar id="tb">
						<p:toolbarGroup>

							<p:commandButton
								value="#{resourceBundleServiceImpl.getMessage('novo')}"
								icon="pi pi-file" styleClass="p-mr-2"
								action="#{newBudgetOrderController.newBudget}"
								update="customerForm formItems:dtItems budgetTotals"
								onclick="PF('blockItems').show()">
								<p:confirm type="popup"
									header="#{resourceBundleServiceImpl.getMessage('confirmacao')}"
									message="#{resourceBundleServiceImpl.getMessage('restaurar_budget_form')}"
									icon="pi pi-info-circle" />
							</p:commandButton>

							<p:commandButton action="#{newBudgetOrderController.validBudget}"
								value="#{resourceBundleServiceImpl.getMessage('salvar_orcamento')}"
								icon="pi pi-check" styleClass="ui-button-success " />
							<i class="pi pi-bars p-px-2" />
							<p:commandButton title="Print" icon="pi pi-print"
								styleClass="ui-button-success p-mr-2"
								action="#{budgetExporterShowController.show(newBudgetOrderController.budget)}"
								process="@this" />


							<p:commandButton
								value="#{resourceBundleServiceImpl.getMessage('cliente')}"
								icon="pi pi-eye"
								action="#{customerDetailShowController.show(newBudgetOrderController.budget.customerOnOrder)}" />

						</p:toolbarGroup>
					</p:toolbar>
					<p:sticky target="tb" />
				</h:form>
			</div>

			<div class="p-grid">
				<div class="p-col-12">
					<div class="card">
						<h:form id="customerForm">
							<div class="ui-fluid p-formgrid p-grid">
								<div class="p-field p-col-12 p-xl-4 p-lg-5 p-md-12">
									<p:outputLabel
										value="#{resourceBundleServiceImpl.getMessage('cliente')}" />
									<div class="ui-inputgroup">
										<p:inputText
											value="#{newBudgetOrderController.budget.customerOnOrder.name}-#{newBudgetOrderController.budget.customerOnOrder.store}"
											readonly="true" />
										<p:button icon="pi pi-search" styleClass="ui-button-warning"
											onclick="PF('dlgSearchCustomer').show()"
											disabled="#{not empty newBudgetOrderController.budget.items}"
											id="btnShowSearchCustomer">
											<p:autoUpdate on="eventAddItem" />
										</p:button>
									</div>
								</div>

								<div class="p-field p-col-12 p-xl-3 p-lg-2  p-md-12">
									<p:outputLabel value="CNPJ" for="cnpj" />
									<p:inputMask
										value="#{newBudgetOrderController.budget.customerOnOrder.cnpj}"
										readonly="true" id="cnpj" mask="99.999.999/9999-99" />
								</div>
								<div class="p-field p-col-12 p-xl-4 p-lg-4 p-md-12">
									<p:outputLabel for="endereco"
										value="#{resourceBundleServiceImpl.getMessage('endereco')}" />
									<p:inputText id="endereco"
										value="#{newBudgetOrderController.budget.customerOnOrder.street}, #{newBudgetOrderController.budget.customerOnOrder.city} - #{newBudgetOrderController.budget.customerOnOrder.state}"
										readonly="true" />
								</div>
								<div class="p-field p-col-12 p-xl-3 p-lg-2  p-md-12">
									<p:outputLabel
										value="#{resourceBundleServiceImpl.getMessage('condicao_pagamento')}"
										for="pTerms" />
									<p:inputText
										value="#{newBudgetOrderController.budget.customerOnOrder.paymentTerms}"
										readonly="true" id="pTerms" />
								</div>

								<ui:fragment
									rendered="#{newBudgetOrderController.budget.customerOnOrder.type eq 'PROSPECT'}">

									<div class="p-field p-col-12 p-xl-3 p-lg-2  p-md-12">
										<p:outputLabel value="Vendedor" for="sellerType" />
										<p:inputText
											value="#{newBudgetOrderController.budget.customerOnOrder.sellerType}"
											readonly="true" id="sellerType" />
									</div>

								</ui:fragment>
								<div class="p-field p-col-12 p-xl-4 p-lg-5 p-md-12">
									<p:outputLabel for="mensagem" value="Mensagem" />
									<p:inputTextarea id="mensagem" rows="4" maxlength="250"
										value="#{newBudgetOrderController.budget.message}"
										onchange="saveMessage();" />
								</div>
								<p:remoteCommand name="saveMessage"
									process="@this,@form:mensagem"
									action="#{orderMessageMessageController.displayMessage}" />


							</div>
						</h:form>
					</div>
				</div>

				<div class="p-col-12" id="divCart">
					<div class="card">
						<div class="card-header">
							<h5>#{resourceBundleServiceImpl.getMessage('carrinho_compras')}</h5>
						</div>
						<h:form id="formItems">
							<p:remoteCommand name="updateDtItems" action="#" process="@none"
								update="dtItems" />

							<p:toolbar styleClass="p-mb-4">
								<p:toolbarGroup>
									<p:commandButton
										action="#{productSearchShowController.show(newBudgetOrderController.budget.customerOnOrder)}"
										process="@this" icon="pi pi-plus"
										styleClass="ui-button-raised ui-button-success p-mr-2"
										title="Adicionar novo item">
										<p:ajax event="dialogReturn"
											listener="#{newBudgetOrderController.handleProductResult}"
											onstart="PF('topSidebar').show()"
											oncomplete="PF('topSidebar').hide()" />
									</p:commandButton>
									<p:commandButton
										value="#{resourceBundleServiceImpl.getMessage('abrir')}"
										icon="pi pi-folder-open" styleClass="ui-button-success p-mr-2"
										action="#{itemImportShowController.show(newBudgetOrderController.budget)}"
										process="@this" title="Importar itens">
										<p:ajax event="dialogReturn"
											listener="#{newBudgetOrderController.handleItemImportReturn}"
											onstart="PF('topSidebar').show()"
											oncomplete="PF('topSidebar').hide()" />
									</p:commandButton>

									<p:menuButton
										value="#{resourceBundleServiceImpl.getMessage('descontos')}"
										disabled="#{empty newBudgetOrderController.budget.items}">
										<p:menuitem
											value="#{resourceBundleServiceImpl.getMessage('linha')}"
											action="#{orderDiscountShowController.show(newBudgetOrderController.budget,1)}"
											process="@this" icon="pi pi-tag">
											<p:ajax event="dialogReturn"
												update="formItems:dtItems,budgetTotals" />
										</p:menuitem>
										<p:menuitem
											value="#{resourceBundleServiceImpl.getMessage('global')}"
											action="#{orderDiscountShowController.show(newBudgetOrderController.budget,0)}"
											icon="pi pi-tag">
											<p:ajax event="dialogReturn"
												update="formItems:dtItems,budgetTotals" />
										</p:menuitem>
									</p:menuButton>
								</p:toolbarGroup>

							</p:toolbar>


							<p:dataTable value="#{newBudgetOrderController.budget.items}"
								var="item" editable="true" rowKey="#{item.commercialCode}"
								id="dtItems" reflow="true" size="small" scrollable="true"
								widgetVar="dtItems" rowIndexVar="crrIndex" filterDelay="100">
								<p:autoUpdate on="eventAddItem" />
								<p:autoUpdate on="eventAddLineDiscount" />
								<p:ajax event="rowEdit"
									listener="#{newBudgetOrderController.onRowItemEdit}"
									update="budgetTotals" />
								<p:ajax event="rowToggle" onstart="PF('expandingItem').show();"
									oncomplete="PF('expandingItem').hide();" />

								<f:facet name="header">
									<div class="p-d-flex p-jc-between p-ai-center">
										<div>
											<p:commandButton id="toggler" type="button" value="Colunas"
												icon="pi pi-align-justify" />
											<p:columnToggler datasource="dtItems" trigger="toggler" />
										</div>
									</div>
								</f:facet>
								<f:facet name="footer">
									<span class="p-text-bold">Há
										#{fn:length(newBudgetOrderController.budget.items)} produtos.</span>
								</f:facet>
								<p:column exportable="false" style="width:2rem">
									<p:rowToggler />
								</p:column>

								<p:column style="width:2rem">
									<h:outputText value="#{crrIndex+1}" />
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('codigo_comercial')}"
									filterBy="#{item.product.commercialCode}">
									<h:outputText value="#{item.product.commercialCode}" />
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('descricao')}"
									filterBy="#{item.product.description}">
									<h:outputText value="#{item.product.description}" />
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('linha')}"
									filterBy="#{item.product.line}">
									<h:outputText value="#{item.product.line}" />
								</p:column>

								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('quantidade')}"
									sortBy="#{item.value.quantity}">
									<p:cellEditor>
										<f:facet name="output">
											<h:outputText value="#{item.value.quantity}" />
										</f:facet>
										<f:facet name="input">
											<p:spinner
												value="#{newBudgetOrderController.onRowItemQuantity}"
												style="width:100%" label="Name" id="spnQ" />
											<p:tooltip
												value="Entre com um número múltiplo de #{item.value.multiple}"
												for="spnQ" />
										</f:facet>
									</p:cellEditor>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('preco_unitario')}"
									sortBy="#{item.value.unitValue}">
									<h:outputText value="#{item.value.unitValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('total')}"
									sortBy="#{item.value.totalValue}">
									<h:outputText value="#{item.value.totalValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('valor_st')}"
									sortBy="#{item.value.totalStValue}">
									<h:outputText value="#{item.value.totalStValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>

								<p:column
									headerText="#{resourceBundleServiceImpl.getMessage('total_com_st')}"
									sortBy="#{item.value.totalGrossValue}">
									<h:outputText value="#{item.value.totalGrossValue}">
										<f:convertNumber currencySymbol="R$" type="currency"
											locale="pt_BR" />
									</h:outputText>
								</p:column>
								<p:column style="width:2rem">
									<p:rowEditor editTitle="Edit Row" cancelTitle="Cancel Edit"
										saveTitle="Save Row" />
								</p:column>
								<p:column>


									<p:commandButton icon="pi pi-times"
										styleClass="rounded-button ui-button-danger ui-button-flat p-mr-2 p-mb-2"
										title="Remover"
										action="#{orderCommonBehaviorHelperImpl.removeItem(newBudgetOrderController.budget,item)}"
										update="formItems:dtItems,budgetTotals,customerForm:btnShowSearchCustomer"
										process="@this"
										oncomplete="turnDtScrollBodyResponsive('dtItems','32vh')" />
								</p:column>

								<p:rowExpansion>
									<div id="rowData" class="p-grid p-ml-3  p-mt-2">
										<div id="div-img-wrraper" class="p-col-fixed"
											style="width: 12rem">
											<div id="div-img-loader-#{item.product.commercialCode}"
												style="display: none">
												<i class="pi pi-spin pi-spinner" style="font-size: 3rem;" />
											</div>
											<div id="div-img-#{item.product.commercialCode}">
												<h:form>
													<p:graphicImage value="#{item.product.imageStreams}"
														stream="false" styleClass="w3-round-xlarge product-image"
														style="height: 8.2rem; width: 10rem" id="img"
														alt="Imagem não encontrada"
														rendered="#{item.product.image.currentState eq 'FOUND' || item.product.image.currentState eq 'NOT_FOUND'}" />

													<p:commandButton value="Imagem" icon="pi pi-image"
														action="#{productImageLoaderController.loadImage(item.product)}"
														rendered="#{item.product.image.currentState eq 'NOT_LOADED' || item.product.image.currentState eq 'TIMEOUT_EXCPTION'}"
														update="@form" process="@this"
														onstart="$('#div-img-loader-#{item.product.commercialCode}').show();$('#div-img-#{item.product.commercialCode}').hide();"
														oncomplete="$('#div-img-loader-#{item.product.commercialCode}').hide();$('#div-img-#{item.product.commercialCode}').show();" />

												</h:form>
											</div>

										</div>
										<div class="p-col-2">
											<div class="p-text-bold p-mb-2">#{item.product.commercialCode}</div>
											<div class="p-text-normal p-mb-1">#{item.product.description}</div>
											<div class="p-text-normal p-mb-1">Quantidade múltiplo
												de #{item.value.multiple}</div>
											<div id="div-stock-wrapper">
												<div id="div-loading-stock-#{item.product.commercialCode}"
													style="display: none">
													Buscando estoque... <i class="pi pi-spin pi-spinner"
														style="font-size: 3rem;" />
												</div>
												<div id="div-stock-content-#{item.product.commercialCode}">
													<h:form>
														<div class="p-text-normal p-text-uppercase"
															style=" display: #{item.product.stock eq null ?'none':block};">
															<span
																class="#{item.product.stock > 0 ? 'product-in-stock' : 'product-out-stock'}">
																#{productStockMessageController.getMessage(item.product.stock)}
															</span>

														</div>
														<p:remoteCommand name="loadStock"
															action="#{findProductStockController.find(item.product)}"
															process="@this" update="@form"
															autoRun="#{item.product.stock eq null}"
															onstart="$('#div-stock-content-#{item.product.commercialCode}').hide();$('#div-loading-stock-#{item.product.commercialCode}').show();"
															oncomplete="$('#div-stock-content-#{item.product.commercialCode}').show();$('#div-loading-stock-#{item.product.commercialCode}').hide();" />
													</h:form>
												</div>
											</div>
										</div>
										<div class="p-col"
											id="product-tech-loader-#{item.product.commercialCode}"
											style="display: none">
											Buscando detalhes técnicos... <i
												class="pi pi-spin pi-spinner" style="font-size: 3rem;" />
										</div>
										<div class="p-col-6 product-tech-data"
											id="product-tech-#{item.product.commercialCode}">
											<h:form>
												<p:panelGrid columns="4"
													columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
													layout="grid" styleClass="ui-panelgrid-blank ui-fluid"
													style="border:0px none; background-color:transparent;"
													id="pnTechData"
													rendered="#{item.product.productTechDetail != null}">

													<p:outputLabel for="@next" value="Aplicação:"
														styleClass="p-text-bold" />
													<p:outputLabel
														value="#{item.product.productTechDetail.application}"
														styleClass="label-r" />

													<p:outputLabel for="@next" value="Substituições:"
														styleClass="p-text-bold" />
													<p:outputLabel
														value="#{item.product.productTechDetail.productsReplaces}"
														styleClass="label-r" />

													<p:outputLabel for="@next" value="Peso bruto:"
														styleClass="p-text-bold" />
													<p:outputLabel
														value="#{item.product.productTechDetail.grossWeight}"
														styleClass="label-r" />

													<p:outputLabel for="@next" value="Dimensões da caixa:"
														styleClass="p-text-bold" />
													<p:outputLabel
														value="#{item.product.productTechDetail.packageDimension}"
														styleClass="label-r" />


													<p:commandButton
														action="#{productTechDataShowController.show(item.product)}"
														process="@this" icon="pi pi-exclamation-circle"
														styleClass="rounded-button ui-button-flat p-mr-2 p-mb-2"
														title="Site" />

												</p:panelGrid>
												<p:commandButton value="Dados técnicos"
													rendered="#{item.product.productTechDetail eq null}"
													icon="pi pi-th-large"
													action="#{productTechDetailLoaderController.load(item.product)}"
													onstart="$('#product-tech-loader-#{item.product.commercialCode}').show();$('#product-tech-#{item.product.commercialCode}').hide();"
													oncomplete="$('#product-tech-loader-#{item.product.commercialCode}').hide();$('#product-tech-#{item.product.commercialCode}').show();"
													update="@form" process="@this" />

											</h:form>

										</div>
									</div>
								</p:rowExpansion>

							</p:dataTable>

						</h:form>
						<p:blockUI block="formItems" widgetVar="blockItems"
							blocked="#{newBudgetOrderController.budget.customerOnOrder == null}">
							<i class="pi pi-lock" style="font-size: 3rem" />
						</p:blockUI>

						<p:sidebar widgetVar="expandingItem" modal="true"
							baseZIndex="1000" position="bottom" showCloseIcon="false">
							<h3 style="font-weight: normal">Expandindo item...</h3>
							<div class="p-d-flex p-ai-end">
								<p:skeleton shape="circle" size="2rem" class="p-mr-2" />
								<p:skeleton shape="circle" size="3rem" class="p-mr-2" />
								<p:skeleton shape="circle" size="4rem" class="p-mr-2" />
								<p:skeleton shape="circle" size="5rem" />
							</div>
						</p:sidebar>

					</div>
				</div>

				<div class="p-col-12 p-shadow-24" id="totals">
					<div class="card ">
						<h:form id="budgetTotals">
							<div class="ui-fluid p-formgrid p-grid">
								<div class="p-field p-col-12 p-md-3">
									<p:outputLabel for="liquidV"
										value="#{resourceBundleServiceImpl.getMessage('total_sem_st')}" />
									<p:inputNumber id="liquidV"
										value="#{newBudgetOrderController.budget.liquidValue}"
										symbol="R$ " symbolPosition="p" readonly="true"
										decimalSeparator="," thousandSeparator="." />
								</div>
								<div class="p-field p-col-12 p-md-3">
									<p:outputLabel for="stT"
										value="#{resourceBundleServiceImpl.getMessage('valor_st')}" />
									<p:inputNumber id="stT"
										value="#{newBudgetOrderController.budget.stValue}"
										symbol="R$ " symbolPosition="p" readonly="true"
										decimalSeparator="," thousandSeparator="." />
								</div>
								<div class="p-field p-col-12 p-md-3">
									<p:outputLabel for="grossV"
										value="#{resourceBundleServiceImpl.getMessage('total_com_st')}" />
									<p:inputNumber id="grossV"
										value="#{newBudgetOrderController.budget.grossValue}"
										symbol="R$ " symbolPosition="p" readonly="true"
										decimalSeparator="," thousandSeparator="." />
								</div>
							</div>
							<p:autoUpdate on="eventAddItem" />
						</h:form>
					</div>
				</div>




			</div>

			<p:dialog widgetVar="dlgSearchCustomer" modal="true"
				header="#{holdMessageView.label('busca_de_cliente')}"
				positionType="absolute" responsive="true" blockScroll="true">
				<div style="max-height: 65vh; overflow: auto">
					<p:tabView>
						<p:tab
							title="#{resourceBundleServiceImpl.getMessage('palavra_chave')}">
							<h5>
								<h:outputText
									value="#{resourceBundleServiceImpl.getMessage('busca_por_nome_cliente')}" />
							</h5>
							<h:form>

								<div class="p-formgroup-inline">
									<div class="p-field">
										<div class="ui-inputgroup">
											<p:inputText type="text" placeholder="keyword"
												value="#{newBudgetOrderController.cNameToSearch}"
												required="true" id="cName" />

											<p:commandButton icon="pi pi-search"
												action="#{customerSearchShowController.show(newBudgetOrderController.cNameToSearch)}">
												<p:ajax event="dialogReturn"
													listener="#{newBudgetOrderController.handleCustomerResult}" />
											</p:commandButton>
										</div>

										<p:message for="cName" />
									</div>

								</div>
							</h:form>
						</p:tab>

						<p:tab title="PROSPECT">
							<h:form>
								<p:panelGrid columns="4"
									columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
									layout="grid" styleClass="ui-panelgrid-blank ui-fluid"
									style="border:0px none; background-color:transparent;" id="pn">

									<p:outputLabel
										value="#{resourceBundleServiceImpl.getMessage('nome')}"
										for="prospName" />
									<p:inputText
										value="#{prospectCustomerFormController.prospectCustomerForm.name}"
										id="prospName" />

									<p:outputLabel for="prospCnpj" value="CNPJ" />
									<p:inputMask id="prospCnpj"
										value="#{prospectCustomerFormController.prospectCustomerForm.cnpj}"
										mask="99.999.999/9999-99" validateMask="true" />

									<p:outputLabel for="@next" value="Vendedor" />
									<p:selectOneMenu
										value="#{prospectCustomerFormController.prospectCustomerForm.sellerType}"
										id="prospVendor">
										<f:selectItem itemLabel="Agrícola" itemValue="AGRICOLA" />
										<f:selectItem itemLabel="Carros" itemValue="CARROS" />
										<f:selectItem itemLabel="Motos" itemValue="MOTOS" />

									</p:selectOneMenu>

									<p:outputLabel
										value="#{resourceBundleServiceImpl.getMessage('condicao_pagamento')}"
										for="prospTerms" />
									<p:inputText
										value="#{prospectCustomerFormController.prospectCustomerForm.paymentTerms}"
										id="prospTerms" />

									<p:row styleClass="my-heading-row">
           				 				Endereço
        							</p:row>

									<p:outputLabel for="cep" value="CEP" />
									<p:inputText id="cep"
										value="#{prospectCustomerFormController.cepToSearch}"
										maxlength="8" oninput="if(this.value.length == 8)findCep()" />

									<p:outputLabel for="prospEndereco"
										value="#{resourceBundleServiceImpl.getMessage('rua')}" />
									<p:inputText id="prospEndereco"
										value="#{prospectCustomerFormController.prospectCustomerForm.street}" />

									<p:outputLabel for="prospBairro"
										value="#{resourceBundleServiceImpl.getMessage('bairro')}" />
									<p:inputText id="prospBairro"
										value="#{prospectCustomerFormController.prospectCustomerForm.district}"
										readonly="true" />

									<p:outputLabel for="prospCidade"
										value="#{resourceBundleServiceImpl.getMessage('cidade')}" />
									<p:inputText id="prospCidade"
										value="#{prospectCustomerFormController.prospectCustomerForm.city}"
										readonly="true" />

									<p:outputLabel for="@next" value="Estado" />
									<p:selectOneMenu id="es" filter="true" panelStyle="width:180px"
										value="#{prospectCustomerFormController.prospectCustomerForm.stateAcronym}"
										editable="false">
										<f:selectItems value="#{brazilianStateServiceImpl.findAll()}"
											var="state" itemLabel="#{state.name}"
											itemValue="#{state.acronym}" />
									</p:selectOneMenu>


									<p:row>
										<p:column styleClass="ui-grid-col-12">
											<p:commandButton icon="pi pi-check"
												styleClass="ui-button-raised ui-button-success p-mr-2 p-mb-2"
												action="#{prospectCustomerFormController.create}"
												process="@this,@form:pn" oncomplete="getProspect()" />
										</p:column>
										<p:growl for="prospCnpj" id="growlForCnpj" />
									</p:row>
								</p:panelGrid>
								<p:remoteCommand
									action="#{prospectCustomerFormController.findCep}"
									name="findCep" process="@this,@form:cep"
									onstart="PF('blockForCepSearch').show()"
									oncomplete="PF('blockForCepSearch').hide()"
									update="growl,@form:prospEndereco,@form:es,@form:cep,@form:prospCidade,@form:prospBairro" />
								<p:remoteCommand name="getProspect"
									action="#{newBudgetOrderController.getProspectFromSession}"
									process="@this" update=":customerForm,@form,budgetToolsForm"
									oncomplete="PF('blockItems').hide();PF('dlgSearchCustomer').hide();" />
								<p:blockUI widgetVar="blockForCepSearch" block="@form" />
							</h:form>

						</p:tab>
					</p:tabView>
				</div>
			</p:dialog>


			<p:confirmPopup global="true">
				<p:commandButton value="#{holdMessageView.label('nao')}"
					type="button" styleClass="ui-confirm-popup-no ui-button-flat" />
				<p:commandButton value="#{holdMessageView.label('sim')}"
					type="button" styleClass="ui-confirm-popup-yes" />
			</p:confirmPopup>
			<p:remoteCommand name="cleanBudgetObj"
				action="#{newBudgetOrderController.newBudget}" process="@this"
				update="customerForm, formItems:dtItems, budgetTotals" />

			<p:dialog widgetVar="dlgBudgetPersistForm" modal="true"
				header="#{resourceBundleServiceImpl.getMessage('efetivar_orcamento')}"
				responsive="true">
				<h:form>
					<div class="ui-fluid p-formgrid p-grid">
						<div class="p-field p-col">
							<label for="pR">#{resourceBundleServiceImpl.getMessage('pedido_representante')}</label>
							<p:inputText id="pR" type="text"
								value="#{newBudgetOrderController.customerRepresentativeOrderForm.representativeOrder}" />
						</div>
						<div class="p-field p-col">
							<label for="pC">#{resourceBundleServiceImpl.getMessage('pedido_cliente')}</label>
							<p:inputText id="pC" type="text"
								value="#{newBudgetOrderController.customerRepresentativeOrderForm.customerOrder}" />
						</div>
					</div>
					<p:commandButton icon="pi pi-check" styleClass="ui-button-success"
						process="@this,@form" action="#{newBudgetOrderController.save}"
						onstart="PF('persistingBudget').show();PF('dlgBudgetPersistForm').hide();"
						oncomplete="onCompletePersistBudget()" />
				</h:form>
			</p:dialog>

			<p:dialog header="Status" modal="true" closable="false"
				widgetVar="persistingBudget" responsive="true">
				<div id="statLoading">
					<h5 class="p-mt-3">#{resourceBundleServiceImpl.getMessage('salvando_orcamento')}</h5>
					<div class="p-d-flex p-ai-end">
						<p:skeleton size="2rem" class="p-mr-2" />
						<p:skeleton size="3rem" class="p-mr-2" />
						<p:skeleton size="4rem" class="p-mr-2" />
						<p:skeleton size="5rem" />
					</div>
				</div>

				<div id="statConluded" class="p-grid p-flex-column"
					style="display: none;">
					<div class="p-col">
						<div class="box">
							<p:staticMessage severity="info" summary="Salvo com sucesso!"
								detail="Orçamento de número #{newBudgetOrderController.budget.code}"
								style="width: 100%" id="successPersisted" />
						</div>
					</div>
					<div class="p-col">
						<div class="box">
							<p:commandButton value="OK"
								action="#{newBudgetOrderController.newBudget}" process="@this"
								update="customerForm, formItems:dtItems, budgetTotals"
								styleClass="p-mr-2 p-mb-2"
								oncomplete="PF('persistingBudget').hide()" />
							<p:linkButton value="Visualizar outros pedidos" icon="pi pi-star"
								outcome="budgets" styleClass="p-mb-2" />
						</div>
					</div>
				</div>
			</p:dialog>
			<p:sidebar widgetVar="topSidebar" position="top" baseZIndex="10000">
				<h4>Adicionado produto ao orçamento e calculando totais...</h4>
			</p:sidebar>
			<style type="text/css">
.cheap {
	background-color: #ff9999 !important;
	background-image: none !important;
	color: #000000 !important;
}

/* reset on the showcase style*/
body .ui-panelgrid .ui-panelgrid-cell {
	background-color: transparent;
}

/* example use of styles for your form */
.my-heading-row {
	background-color: var(- -surface-c);
	font-weight: bold;
}
</style>

			<script type="text/javascript">
				//<![CDATA[
				var processFinished = false;

				function turnDtScrollBodyResponsive(clientId, maxHeight) {
					PF(clientId).scrollBody[0].style.setProperty('max-height',
							maxHeight);
				}

				function getResponseHeader(xhr) {
					return xhr.getResponseHeader("Backbone-Status") != "Error";
				}
				function onCompletePersistBudget() {
					$("#statLoading").hide();
					$("#statConluded").show();
				}
				//	]]>
			</script>
		</f:view>
	</ui:define>

</ui:composition>